var f=[["&","&amp;"],[" ","&nbsp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"],["\xA2","&cent;"],["\xA3","&pound;"],["\xA5","&yen;"],["\u20AC","&euro;"],["\xA9","&copy;"],["\xAE","&reg;"]],p=[["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"]];function h(e){return e.replace(/\r\n/g,`
`)}function $(e){return e.replace(/^\</,"").replace(/([^\<][!?/])?\>$/,"").replace(/\s+/g," ").trim()}function C(e){return e.tag===null}function S(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}function a(e){return encodeURIComponent(e)}function d(e){return decodeURIComponent(e)}function m(e){for(let t=0;t<f.length;t++)e=e.replace(new RegExp(f[t][0],"g"),f[t][1]);return e}function b(e){for(let t=f.length-1;t>=0;t--)e=e.replace(new RegExp(f[t][1],"g"),f[t][0]);return e}function T(e){for(let t=0;t<p.length;t++)e=e.replace(new RegExp(p[t][0],"g"),p[t][1]);return e}function y(e){return e.replace(/<!--([\s\S]*?)-->/g,function(...t){return`<!-->${a(t[1])}</!-->`})}function x(e){return e.replace(/(<script(?:[\s\S]*?)>)([\s\S]*?)(<\/script>)/g,function(...t){return`${t[1]}${a(t[2])}${t[3]}`})}function E(e){return e.replace(/(>)([\s\S]*?)(<)/g,function(...t){return`${t[1]}${m(t[2])}${t[3]}`})}function I(e){function t(...n){return`=${a(n[1])} `}return e.replace(/\='([^'>]*?)'/g,t).replace(/\="([^">]*?)"/g,t)}function A(e){let t=$(e).split(/\s/),n={};n.tag=t[0]||"",n.closer=null,n.content=null,n.attributes={},n.children=[],n.isClosing=/^\//.test(n.tag),n.isClosed=n.isClosing,n.tag=n.tag.replace(/^\//,"");for(let c=1;c<t.length;c++){let[r,l]=t[c].split("=");r.length>0&&(typeof l=="string"&&l.length>0?n.attributes[r]=d(l):n.attributes[r]=!0)}return n}function j(e){e=I(E(x(y(h(e)))));let t=0,n=/<[^>]*?>/g,c,r=[],l=[],o;for(;c=n.exec(e);){let i=e.substring(t,c.index).trim();if(i.length>0&&(o={tag:null,closer:null,content:b(i),attributes:{},children:[]},r.push(o)),o=A(c[0]),!o.isClosing)r.push(o),l.push(o);else{let u=S(r,function(s){return!s.isClosed&&s.tag===o.tag});if(u>-1&&(r[u].isClosed=!0,r[u].children=r.splice(u+1,r.length-u+1),["script","!--"].indexOf(r[u].tag)>-1))for(let s=0;s<r[u].children.length;s++)C(r[u].children[s])&&(r[u].children[s].content=d(r[u].children[s].content))}t=n.lastIndex}for(let i of l)i.tag.toUpperCase()==="!DOCTYPE"?i.closer="":i.tag.toLowerCase()==="?xml"?i.closer="?":i.tag==="!--"?i.closer="--":i.isClosed||(i.closer=" /"),delete i.isClosed,delete i.isClosing;return{tag:null,closer:null,content:null,attributes:{},children:r}}function R(e){let t="";for(let[n,c]of Object.entries(e))typeof c=="string"?t+=` ${n}="${T(c)}"`:c===!0&&(t+=` ${n}`);return t}function g(e){let{tag:t,closer:n,attributes:c,content:r,children:l}=e,o="";if(typeof t=="string"){if(o+=`<${t}`,typeof c=="object"&&(o+=R(c)),typeof n!="string"&&(o+=">"),Array.isArray(l))for(let i of l)o+=g(i);typeof n=="string"?o+=`${n}>`:o+=`</${t}>`}else if(typeof r=="string")o=r;else if(Array.isArray(l))for(let i of l)o+=g(i);return o}export{j as toObj,g as toStr};
