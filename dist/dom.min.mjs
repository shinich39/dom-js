var f=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"]];function d(e){return e.replace(/\r\n/g,`
`)}function $(e){return e.replace(/^\</,"").replace(/([^\<][!?/])?\>$/,"").replace(/\s+/g," ").trim()}function h(e){return e.tag===null}function C(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}function p(e){return encodeURIComponent(e)}function g(e){return decodeURIComponent(e)}function a(e){for(let t=0;t<f.length;t++)e=e.replace(new RegExp(f[t][0],"g"),f[t][1]);return e}function m(e){for(let t=f.length-1;t>=0;t--)e=e.replace(new RegExp(f[t][1],"g"),f[t][0]);return e}function S(e){return e.replace(/<!--([\s\S]*?)-->/g,function(...t){return`<!-->${p(t[1])}</!-->`})}function b(e){return e.replace(/(<script(?:[\s\S]*?)>)([\s\S]*?)(<\/script>)/g,function(...t){return`${t[1]}${p(t[2])}${t[3]}`})}function x(e){return e.replace(/(>)([\s\S]*?)(<)/g,function(...t){return`${t[1]}${a(t[2])}${t[3]}`})}function y(e){function t(...n){return`=${p(n[1])} `}return e.replace(/\='([^'>]*?)'/g,t).replace(/\="([^">]*?)"/g,t)}function T(e){let t=$(e).split(/\s/),n={};n.tag=t[0]||"",n.closer=null,n.content=null,n.attributes={},n.children=[],n.isClosing=/^\//.test(n.tag),n.isClosed=n.isClosing,n.tag=n.tag.replace(/^\//,"");for(let c=1;c<t.length;c++){let[r,u]=t[c].split("=");r.length>0&&(typeof u=="string"&&u.length>0?n.attributes[r]=g(u):n.attributes[r]=!0)}return n}function E(e){e=y(x(b(S(d(e)))));let t=0,n=/<[^>]*?>/g,c,r=[],u=[],o;for(;c=n.exec(e);){let i=e.substring(t,c.index).trim();if(i.length>0&&(o={tag:null,closer:null,content:m(i),attributes:{},children:[]},r.push(o)),o=T(c[0]),!o.isClosing)r.push(o),u.push(o);else{let l=C(r,function(s){return!s.isClosed&&s.tag===o.tag});if(l>-1&&(r[l].isClosed=!0,r[l].children=r.splice(l+1,r.length-l+1),["script","!--"].indexOf(r[l].tag)>-1))for(let s=0;s<r[l].children.length;s++)h(r[l].children[s])&&(r[l].children[s].content=g(r[l].children[s].content))}t=n.lastIndex}for(let i of u)i.tag.toUpperCase()==="!DOCTYPE"?i.closer="":i.tag.toLowerCase()==="?xml"?i.closer="?":i.tag==="!--"?i.closer="--":i.isClosed||(i.closer=" /"),delete i.isClosed,delete i.isClosing;return r}function j(e){let t="";for(let[n,c]of Object.entries(e))typeof c=="string"?t+=` ${n}="${a(c)}"`:c===!0&&(t+=` ${n}`);return t}function I(e){let{tag:t,closer:n,attributes:c,content:r,children:u}=e,o="";if(typeof t=="string"){if(o+=`<${t}`,typeof c=="object"&&(o+=j(c)),typeof n!="string"&&(o+=">"),Array.isArray(u))for(let i of u)o+=I(i);typeof n=="string"?o+=`${n}>`:o+=`</${t}>`}else typeof r=="string"&&(o=r);return o}export{E as toObj,I as toStr};
