var s=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&apos;"]];function d(e){return e.replace(/\r\n/g,`
`)}function g(e){return e.replace(/^\<|[\s!?/]*\>$/g,"").replace(/\s+/g," ").trim()}function a(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}function p(e){return encodeURIComponent(e)}function $(e){for(let t=0;t<s.length;t++)e=e.replace(new RegExp(s[t][0],"g"),s[t][1]);return e}function h(e){for(let t=s.length-1;t>=0;t--)e=e.replace(new RegExp(s[t][1],"g"),s[t][0]);return e}function C(e){return e.replace(/<!--([\s\S]*?)-->/g,function(...t){return`<!-->${p(t[1])}</!-->`})}function m(e){return e.replace(/(<script(?:[\s\S]*?)>)([\s\S]*?)(<\/script>)/g,function(...t){return`${t[1]}${p(t[2])}${t[3]}`})}function S(e){return e.replace(/(>)([\s\S]*?)(<)/g,function(...t){return`${t[1]}${$(t[2])}${t[3]}`})}function b(e){function t(...n){return`=${p(n[1])} `}return e.replace(/\="([^"]*?)"/g,t).replace(/\='([^']*?)'/g,t)}function x(e){let t=g(e).split(/\s/),n={};n.tag=t[0]||"",n.closer=null,n.attributes={},n.children=[],n.isClosing=/^\//.test(n.tag),n.isClosed=n.isClosing,n.tag=n.tag.replace(/^\//,"");for(let i=1;i<t.length;i++){let[r,c]=t[i].split("=");r.length>0&&(typeof c=="string"&&c.length>0?n.attributes[r]=decodeURIComponent(c):n.attributes[r]=!0)}return n}function T(e){e=b(S(m(C(d(e)))));let t=0,n=/<[^>]*?>/g,i,r=[],c=[];for(;i=n.exec(e);){let o=e.substring(t,i.index).trim();o.length>0&&r.push(h(o));let f=x(i[0]);if(!f.isClosing)r.push(f),c.push(f);else{let l=a(r,function(u){return!u.isClosed&&u.tag===f.tag});if(l>-1&&(r[l].isClosed=!0,r[l].children=r.splice(l+1,r.length-l+1),["script","!--"].indexOf(r[l].tag)>-1))for(let u=0;u<r[l].children.length;u++)typeof r[l].children[u]=="string"&&(r[l].children[u]=decodeURIComponent(r[l].children[u]))}t=n.lastIndex}for(let o of c)o.tag.toUpperCase()==="!DOCTYPE"?o.closer="":o.tag.toLowerCase()==="?xml"?o.closer="?":o.tag==="!--"?o.closer="--":o.isClosed||(o.closer=" /"),delete o.isClosed,delete o.isClosing;return r}function y(e){let t="";for(let[n,i]of Object.entries(e))typeof i=="string"?t+=` ${n}="${i}"`:i===!0&&(t+=` ${n}`);return t}function I(e){if(typeof e=="string")return e;let{tag:t,closer:n,attributes:i,children:r}=e,c=`<${t}${y(i||{})}`;if(typeof n!="string"&&(c+=">"),Array.isArray(r))for(let o of r)c+=I(o);return typeof n=="string"?c+=`${n}>`:c+=`</${t}>`,c}export{T as toObj,I as toStr};
